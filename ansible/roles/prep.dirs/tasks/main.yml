- name: Create code directory
  file:
    path: "{{ code_dir }}"
    state: directory

# make sure to clear the packaging dirctory to have a clean slate
- file:
    path: "{{ spec_dir }}"
    state: "{{ item }}"
  loop:
    - absent
    - directory

- name: copy packaging information
  synchronize:
    src: ../packaging/
    dest: "{{ spec_dir }}"

- file:
    path: "{{ srpm_dir }}"
    state: directory

- file:
    path: "{{ rpms_dir }}"
    state: directory

- file:
    path: "{{ mock_dir }}"
    state: directory

- name: copy mock config files
  copy:
    src: "{{ item }}"
    dest: "{{ mock_dir }}"
  loop:
    - /etc/mock/centos-stream+epel-next-8-x86_64.cfg
    - /etc/mock/centos-stream+epel-next-9-x86_64.cfg
    - glusterfs-nightly-repo.tpl

- name: copy fedora mock config files
  copy:
    src: "{{ item }}"
    dest: "{{ mock_dir }}"
  with_fileglob:
    - "/etc/mock/fedora-*-x86_64.cfg"

- name: adapt mock config to use additional template
  lineinfile:
    path: "{{ item }}"
    insertafter: EOF
    line: "include('{{ mock_dir }}/glusterfs-nightly-repo.tpl')"
  with_items:
    - "{{ mock_dir }}/centos-stream+epel-next-8-x86_64.cfg"
    - "{{ mock_dir }}/centos-stream+epel-next-9-x86_64.cfg"
